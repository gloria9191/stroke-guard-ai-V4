<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>StrokeGuard AI - 검사 시작</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: #0f0f23;
            color: white;
            font-family: "Noto Sans KR", sans-serif;
        }
        .container-box {
            max-width: 700px;
            margin: 60px auto;
            background: rgba(255,255,255,0.07);
            padding: 40px;
            border-radius: 25px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.45);
        }
        .step-box { display: none; animation: fade 0.3s ease }
        .step-box.active { display: block; }
        @keyframes fade { from {opacity:0; transform: translateY(10px)} to {opacity:1; transform:none} }

        .btn-opt {
            width: 48%;
            padding: 18px;
            border-radius: 18px;
            font-weight: 600;
            border: 2px solid #6c5ce7;
            background: white;
            color: #6c5ce7;
        }
        .btn-opt.active, .btn-opt:hover {
            background: #6c5ce7;
            color: white;
        }

        #loading-screen {
            position: fixed;
            top:0; left:0; right:0; bottom:0;
            background:#0f0f23;
            display:none;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            z-index:999;
        }
    </style>
</head>

<body>
<div class="container-box">
    <h1 class="text-center mb-4">
        <i class="fa-solid fa-brain me-2"></i>StrokeGuard AI
    </h1>

    <div class="progress mb-4">
        <div class="progress-bar" id="prog" style="width:12.5%"></div>
    </div>

    <h3 id="question" class="text-center mb-4">1/8 성별을 선택해주세요</h3>

    <!-- STEP 1 -->
    <div id="step1" class="step-box active text-center">
        <button class="btn btn-opt active" data-value="1">남성</button>
        <button class="btn btn-opt" data-value="2">여성</button>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="step-box">
        <input id="age" type="number" class="form-control form-control-lg text-center" placeholder="나이 (예: 65)">
    </div>

    <!-- STEP 3 -->
    <div id="step3" class="step-box">
        <input id="bmi" type="number" step="0.1" class="form-control form-control-lg text-center" placeholder="BMI (예: 24.5)">
    </div>

    <!-- STEP 4 -->
    <div id="step4" class="step-box">
        <input id="sbp" type="number" class="form-control form-control-lg text-center" placeholder="수축기 혈압 (예: 140)">
    </div>

    <!-- STEP 5 -->
    <div id="step5" class="step-box">
        <input id="dbp" type="number" class="form-control form-control-lg text-center" placeholder="이완기 혈압 (예: 90)">
    </div>

    <!-- STEP 6 -->
    <div id="step6" class="step-box">
        <input id="glucose" type="number" step="0.1" class="form-control form-control-lg text-center" placeholder="공복 혈당 (예: 120.0)">
    </div>

    <!-- STEP 7 -->
    <div id="step7" class="step-box text-center">
        <button class="btn btn-opt active" data-value="0">흡연 안 함</button>
        <button class="btn btn-opt" data-value="1">흡연함</button>
    </div>

    <!-- STEP 8 -->
    <div id="step8" class="step-box text-center">
        <button class="btn btn-opt active" data-value="0">음주 안 함</button>
        <button class="btn btn-opt" data-value="1">음주함</button>
    </div>

    <div class="text-center mt-4">
        <button id="prev" class="btn btn-outline-light me-3 d-none">이전</button>
        <button id="next" class="btn btn-primary">다음</button>
        <button id="submit" class="btn btn-danger d-none">예측하기</button>
    </div>
</div>

<!-- 로딩 화면 -->
<div id="loading-screen">
    <h2 class="mb-4">AI가 분석 중입니다...</h2>
    <div class="spinner-border text-light" style="width:5rem;height:5rem;"></div>
</div>

<script>
// 질문 텍스트
const questions = [
    "성별을 선택해주세요",
    "나이를 입력해주세요",
    "BMI를 입력해주세요",
    "수축기 혈압을 입력해주세요",
    "이완기 혈압을 입력해주세요",
    "공복 혈당을 입력해주세요",
    "흡연 여부를 선택해주세요",
    "음주 여부를 선택해주세요"
];

let step = 1;
const data = {gender:1, smoking:0, drinking:0};

function showStep(){
    document.querySelectorAll(".step-box").forEach(s => s.classList.remove("active"));
    document.getElementById("step"+step).classList.add("active");
    document.getElementById("question").innerHTML = `${step}/8 ${questions[step-1]}`;
    document.getElementById("prog").style.width = (step/8*100)+"%";
}

document.querySelectorAll(".btn-opt").forEach(btn=>{
    btn.onclick = function(){
        this.parentNode.querySelectorAll(".btn-opt").forEach(x=>x.classList.remove("active"));
        this.classList.add("active");
    };
});

document.getElementById("next").onclick = ()=>{
    if(step === 1){
        data.gender = document.querySelector("#step1 .active").dataset.value;
    }
    if(step >=2 && step <=6){
        const key = ["","age","bmi","sbp","dbp","glucose"][step];
        const val = document.getElementById(key).value.trim();
        if(!val){ alert("값을 입력해주세요"); return; }
        data[key] = parseFloat(val);
    }
    if(step === 7){
        data.smoking = document.querySelector("#step7 .active").dataset.value;
    }
    if(step === 8){
        data.drinking = document.querySelector("#step8 .active").dataset.value;
    }

    if(step < 8){
        step++;
        showStep();
        document.getElementById("prev").classList.remove("d-none");
        if(step === 8){
            document.getElementById("next").classList.add("d-none");
            document.getElementById("submit").classList.remove("d-none");
        }
    }
};

document.getElementById("prev").onclick = ()=>{
    if(step > 1){
        step--;
        showStep();
        document.getElementById("next").classList.remove("d-none");
        document.getElementById("submit").classList.add("d-none");
        if(step === 1){
            document.getElementById("prev").classList.add("d-none");
        }
    }
};

document.getElementById("submit").onclick = ()=>{
    document.getElementById("loading-screen").style.display = "flex";

    fetch("/", {
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:new URLSearchParams(data)
    }).then(r=>r.text())
    .then(html=>{
        document.open();
        document.write(html);
        document.close();
    });
};
</script>
</body>
</html>
